# reqdrive

Requirements-driven development pipeline. Automates the flow from requirements documents to pull requests using AI agents.

## How It Works

1. You write requirements as markdown files (`REQ-01-feature-name.md`)
2. reqdrive generates a PRD with user stories from each requirement
3. An AI agent implements each story in an isolated git worktree
4. Automated verification runs tests and checks
5. A PR is created with a validation checklist

## Prerequisites

- `bash` (4.0+)
- `jq`
- `git`
- `gh` (GitHub CLI, authenticated)
- `claude` (Claude Code CLI)

## Installation

```bash
git clone https://github.com/user/reqdrive.git ~/.reqdrive
echo 'export PATH="$HOME/.reqdrive/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

Or use the installer:

```bash
curl -fsSL https://raw.githubusercontent.com/user/reqdrive/main/install.sh | bash
```

## Quick Start

```bash
cd your-project
reqdrive init         # Interactive setup — creates reqdrive.json + agent prompt
reqdrive validate     # Verify configuration
reqdrive run REQ-01   # Run pipeline for a requirement
```

## Commands

| Command | Description |
|---------|-------------|
| `reqdrive init` | Scaffold `reqdrive.json` manifest and agent prompt |
| `reqdrive run REQ-01 REQ-03` | Run pipeline for specific requirements |
| `reqdrive run --all` | Run all requirements (respecting dependency order) |
| `reqdrive run --next` | Auto-detect next available requirements |
| `reqdrive status [run-id]` | Show pipeline run status |
| `reqdrive clean` | Remove all worktrees |
| `reqdrive validate` | Validate the manifest |
| `reqdrive deps` | Print dependency graph and execution tiers |

## Manifest Reference (`reqdrive.json`)

The manifest lives at your project root and configures the entire pipeline.

### `project`

```json
{
  "project": {
    "name": "my-project",
    "title": "My Project"
  }
}
```

### `paths`

```json
{
  "paths": {
    "requirementsDir": "docs/requirements",
    "agentDir": ".reqdrive/agent",
    "appDir": ".",
    "contextFile": "CLAUDE.md"
  }
}
```

| Field | Description |
|-------|-------------|
| `requirementsDir` | Directory containing `REQ-*.md` files |
| `agentDir` | Agent workspace (prompt.md, prd.json, progress) |
| `appDir` | Where commands (test, lint, etc.) are executed |
| `contextFile` | Codebase context file for the agent |

### `requirements`

```json
{
  "requirements": {
    "pattern": "REQ-*-*.md",
    "idRegex": "REQ-[0-9]+",
    "dependencies": {
      "REQ-01": [],
      "REQ-02": ["REQ-01"],
      "REQ-03": ["REQ-01", "REQ-02"]
    }
  }
}
```

Dependencies determine execution order. A requirement won't run until all its dependencies have merged PRs.

### `commands`

```json
{
  "commands": {
    "install": "npm install",
    "test": "npm test",
    "typecheck": "npx tsc --noEmit",
    "lint": null
  }
}
```

Set a command to `null` to disable it. These are used during worktree setup and verification.

### `agent`

```json
{
  "agent": {
    "model": "claude-opus-4-5-20251101",
    "maxIterations": 10,
    "branchPrefix": "reqdrive",
    "worktreePrefix": "reqdrive",
    "completionSignal": "<promise>COMPLETE</promise>"
  }
}
```

### `verification`

```json
{
  "verification": {
    "maxRetries": 3,
    "checks": [
      {"name": "TypeCheck", "command": "npx tsc --noEmit"},
      {"name": "Tests", "command": "npm test"},
      {"name": "Lint", "command": "npx eslint ."}
    ],
    "generateTests": true
  }
}
```

If `checks` is empty, verification falls back to `commands.test`, `commands.typecheck`, and `commands.lint`.

### `pr`

```json
{
  "pr": {
    "labels": ["agent-generated", "needs-validation"],
    "reqLabel": true,
    "setupSteps": [
      "Pull branch: `git checkout {branch}`",
      "Install deps: `npm install`"
    ],
    "regressionChecks": [
      "Existing features still work",
      "Tests pass locally"
    ],
    "footer": "Generated by reqdrive."
  }
}
```

The `{branch}` placeholder in `setupSteps` is replaced with the actual branch name.

### `orchestration`

```json
{
  "orchestration": {
    "maxParallel": 3,
    "worktreeRoot": "../worktrees",
    "baseBranch": "main",
    "stateDir": ".reqdrive/state"
  }
}
```

## Project Layout

After setup, your project will have:

```
your-project/
├── reqdrive.json              # Pipeline configuration
├── .reqdrive/
│   ├── agent/
│   │   └── prompt.md          # Agent instructions
│   └── state/                 # Run state (gitignored)
├── docs/requirements/
│   ├── REQ-01-auth.md         # Requirement documents
│   └── REQ-02-dashboard.md
└── ...
```

## Writing Requirements

Requirements are markdown files in the configured `requirementsDir`. The filename must start with the REQ ID:

```
REQ-01-user-authentication.md
REQ-02-dashboard-widgets.md
```

The content should describe the feature, acceptance criteria, and any technical constraints. The pipeline uses Claude Code's `design-to-prd` skill to convert these into structured user stories.

## Pipeline Stages

For each requirement, the pipeline runs these stages:

1. **Worktree Setup** — Creates an isolated git worktree with a feature branch
2. **PRD Generation** — Converts the requirement doc into structured user stories
3. **Agent Execution** — AI agent implements stories one at a time
4. **Verification** — Runs tests, type checking, and linting
5. **PR Creation** — Creates a GitHub PR with validation checklist

If verification fails, stages 3-4 retry up to `verification.maxRetries` times. If all retries fail, the PR is created as a draft.

## License

MIT
